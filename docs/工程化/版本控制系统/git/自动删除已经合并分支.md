---
id: f44cff448a465ee2ca3198da71bcb121
title: è‡ªåŠ¨åˆ é™¤å·²ç»åˆå¹¶åˆ†æ”¯
---

## branchclear-cli å‘å¸ƒäº† ğŸ‰

ç°åœ¨ä½¿ç”¨[branchclear-cli](https://github.com/mengshang918/branchclear-cli)ä¸€é”®æ¸…é™¤å·²ç»åˆå¹¶çš„åˆ†æ”¯å§ï¼

## git branch --merged|--no-merged [åˆ†æ”¯å]

å‚æ•°è§£é‡Š

1. `--merged`æŸ¥è¯¢å·²ç»åˆå¹¶åˆ°å½“å‰åˆ†æ”¯çš„åˆ†æ”¯å
2. `--no-merged`æŸ¥è¯¢æœªåˆå¹¶åˆ°å½“å‰åˆ†æ”¯çš„åˆ†æ”¯å
3. åˆ†æ”¯åä¸åŠ ï¼Œåˆ™é»˜è®¤ä¸ºå½“å‰åˆ†æ”¯
4. `git branch --merged master`æŸ¥çœ‹æœ¬åœ°å·²ç»åˆå¹¶åˆ° master åˆ†æ”¯
5. `git branch -r --merged origin/master`æŸ¥è¯¢æ‰€æœ‰å·²ç»åˆå¹¶åˆ°è¿œç¨‹ master åˆ†æ”¯çš„è¿œç¨‹åˆ†æ”¯

## [grep](https://www.runoob.com/linux/linux-comm-grep.html)å’Œ[egrep](https://www.runoob.com/linux/linux-comm-egrep.html)

1. Linux `grep` å‘½ä»¤ç”¨äºæŸ¥æ‰¾æ–‡ä»¶é‡Œç¬¦åˆæ¡ä»¶çš„å­—ç¬¦ä¸²

   `grep å‚æ•° æŸ¥è¯¢çš„å­—ç¬¦ä¸² æ–‡ä»¶æˆ–ç›®å½•`

2. `egrep`ç›¸å½“äº`grep -E`ä»£è¡¨ä½¿ç”¨æ­£åˆ™æŸ¥è¯¢æ–‡ä»¶æˆ–ç›®å½•

3. `grep -v`æ˜¾ç¤ºä¸åŒ…å«åŒ¹é…æ–‡æœ¬çš„æ‰€æœ‰è¡Œ

4. `egrep -v '(^\*|master)'`æ˜¾ç¤ºæ‰€æœ‰ä¸åŒ…å«ä»¥\*å¼€å¤´å’Œ master çš„

   ä¸åŒ…å«\*ï¼Œå°±ä¸ä¼šåˆ é™¤å½“å‰åˆ†æ”¯
   ![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/20200110181724619.png)

5. `egrep -v "(^\*|master|HEAD)`æ˜¾ç¤ºæ‰€æœ‰ä¸åŒ…å«ä»¥\*å¼€å¤´å’Œ master ä»¥åŠ HEAD çš„

   git branch -r ä¼šæœ‰ HEAD è¡¨ç¤ºå½“å‰åˆ†æ”¯æŒ‡å‘
   ![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/20200110181741151.png)

## [Cut](https://www.runoob.com/linux/linux-comm-cut.html)

`cut`å‘½ä»¤ç”¨äºå‰ªåˆ‡`origin/`

- -d ï¼šè‡ªå®šä¹‰åˆ†éš”ç¬¦ï¼Œé»˜è®¤ä¸ºåˆ¶è¡¨ç¬¦ã€‚
- -f ï¼šä¸-d ä¸€èµ·ä½¿ç”¨ï¼ŒæŒ‡å®šæ˜¾ç¤ºå“ªä¸ªåŒºåŸŸã€‚
- `cut -d '/' -f num` ä½¿ç”¨/ä½œä¸ºåˆ†éš”ç¬¦ï¼Œå¹¶ä¸”å±•ç¤ºç¬¬äºŒä¸ª

## [tr](https://www.runoob.com/linux/linux-comm-tr.html)

Linux tr å‘½ä»¤ç”¨äºè½¬æ¢æˆ–åˆ é™¤æ–‡ä»¶ä¸­çš„å­—ç¬¦ï¼Œä½† tr åœ¨æ­¤å¹¶ä¸é€‚ç”¨ã€‚

`tr -d 'origin/'` æ˜¯ å°†æ‰€æœ‰çš„ `o`ã€ `r`ã€ `i`ã€ `g`ã€ `n`ã€ `/`æ›¿æ¢

## [sed](https://www.runoob.com/linux/linux-comm-sed.html)

`sed 's/æ­£åˆ™/æ›¿æ¢æˆçš„å­—ç¬¦/g'`

`sed 's/origin\///g'`å°†æ–‡æœ¬ä¸­`origin/`æ›¿æ¢æˆç©ºå­—ç¬¦

## [xargs](https://www.runoob.com/linux/linux-comm-xargs.html)

linux `xargs` æ˜¯ä¸€ä¸ªå¼ºæœ‰åŠ›çš„å‘½ä»¤ï¼Œå®ƒèƒ½å¤Ÿæ•è·ä¸€ä¸ªå‘½ä»¤çš„è¾“å‡ºï¼Œç„¶åä¼ é€’ç»™å¦å¤–ä¸€ä¸ªå‘½ä»¤ã€‚

`xargs -n num` num è¡¨ç¤ºæ¬¡æ•°ï¼Œè¡¨ç¤ºå‘½ä»¤åœ¨æ‰§è¡Œçš„æ—¶å€™ä¸€æ¬¡ç”¨çš„ argument çš„ä¸ªæ•°ï¼Œé»˜è®¤æ˜¯ç”¨æ‰€æœ‰çš„ã€‚

## åˆ é™¤æœ¬åœ°ä»“åº“å¤±æ•ˆçš„çš„è¿œç¨‹åˆ†æ”¯

git remote prune origin

## åˆ é™¤æœ¬åœ°å·²ç» merged çš„åˆ†æ”¯

`git branch --merged | egrep -v '(^\*|master)' |xargs git branch -D`

æ³¨æ„ï¼šåˆ é™¤ä¹‹å‰å…ˆç¡®å®šåˆ é™¤åˆ†æ”¯

## åˆ é™¤è¿œç¨‹å·²ç» merged çš„åˆ†æ”¯

1. å°è¯• 1ï¼š

   `git branch -r --merged origin/master |egrep -v '(master|HEAD)'|cut -b '/' -f 2|xargs -n 3 git push origin --delete`

   æ³¨æ„ï¼šåˆ†æ”¯åå¯èƒ½åŒ…å«/ï¼Œæ¯”å¦‚åˆ†æ”¯ä¸º jxw/testã€‚å¯¹è¿œç¨‹åˆ†æ”¯ origin/jxw/test `cut -b '/' -f 2`ä¼šå¾—åˆ° jxw å’Œ test ä¸¤ä¸ªç»“æœã€‚è¿™ä¸ªæ—¶å€™å»åˆ é™¤ jxw åˆ†æ”¯æ˜¯ä¸å­˜åœ¨çš„ã€‚æ‰€ä»¥éœ€ä½¿ç”¨ç‰¹æ®Šæ–¹æ³•è§„é¿ã€‚

   ä¼˜åŒ–æ–¹æ¡ˆï¼šä½¿ç”¨ sed ä»£æ›¿ cut

2. å°è¯•äºŒï¼š

   `git branch -r --merged origin/master |egrep -v '(master|HEAD)'|sed 's/origin\///g'|xargs -n 3 git push origin --delete`

   æœ‰äº›åˆ†æ”¯åˆ é™¤æŠ¥é”™ï¼Œè¿œç¨‹å¼•ç”¨ä¸å­˜åœ¨ã€‚å¼•å‡ºé—®é¢˜ git branch -r æŸ¥è¯¢çš„ä¸æ˜¯æœ€æ–°çš„ã€‚`git remote prune origin`åˆ é™¤å¤±æ•ˆè¿œç¨‹åˆ†æ”¯

3. æˆåŠŸ

   ```shell
   git remore prune origin|git branch -r --merged origin/babel-prd-6.5 |egrep -v '(master|HEAD)'|grep 'jxw'|sed 's/origin\///g'|xargs -n 3 git push origin --delete
   ```

4. è„šæœ¬å®ç°

   Package.json æ–‡ä»¶

   ```json
   "scripts": {
   		"clear:local": "bash clearBranch.sh local",
   		"clear:remote": "bash clearBranch.sh remote"
     }
   ```

   clearBranch.sh æ–‡ä»¶

   ```powershell
   #!/bin/bash

   # è¿œç¨‹åˆ†æ”¯å¿…é¡»åŒ…å«çš„å­—ç¬¦ï¼Œé»˜è®¤ä¸ºjxw
   inc=$2
   include=${inc:='jxw'}

   case $1 in
       "local")
           echo 'å¼€å§‹æ¸…é™¤æœ¬åœ°å·²ç»åˆå¹¶åˆ°masterçš„åˆ†æ”¯ï¼ˆä¸åŒ…æ‰©å½“å‰åˆ†æ”¯ï¼‰'
           git branch --merged master | egrep -v '(^\*|master)' |xargs git branch -D
           echo 'æœ¬åœ°åˆ†æ”¯åˆ é™¤æ‰§è¡Œå®Œæ¯•'
           ;;
       "remote")
           echo 'å¼€å§‹æ¸…é™¤è¿œç¨‹å·²ç»åˆå¹¶åˆ°masterçš„åˆ†æ”¯'
           git remote prune origin
           echo 'git remote prune origin åˆ é™¤æœ¬åœ°è¿œç¨‹å¤±æ•ˆåˆ†æ”¯æˆåŠŸ'
           echo "å³å°†åˆ é™¤ä»¥ä¸‹è¿œç¨‹åˆ†æ”¯"
           branch=`git branch -r --merged origin/master |egrep -v '(master|HEAD)'|grep $include|sed 's/origin\///g'`
           echo $branch
           echo 'è¾“å…¥yåˆ é™¤ï¼Œnæˆ–ä»»æ„å­—ç¬¦å–æ¶ˆ'
           read $REPLY
           if [ "$REPLY" == 'Y' -o  "$REPLY" == 'y' ];then
               echo $branch |xargs -n 3 git push origin --delete
               echo 'è¿œç¨‹åˆ†æ”¯åˆ é™¤æ‰§è¡Œå®Œæ¯•'
           else
               echo 'å–æ¶ˆåˆ é™¤è¿œç¨‹åˆ†æ”¯'
               exit 0
           fi
           ;;
       *)
           exit 0
           ;;
   esac
   ```
